CFLAGS = -I../include -Wall -fPIC -static -std=c++14
LDFLAGS = -shared

OS = $(shell uname -s)
ifeq ($(OS), Linux)
	CFLAGS += -D__Linux
	EXT = so
else 
	CFLAGS += -D__APPLE__
	EXT = dylib
endif

all:
	@rm -f lib/*.$(EXT)
	@rm -f *.o
	g++ $(CFLAGS) -c common/v_repLib.cpp -o v_repLib.o
	g++ $(CFLAGS) -c v_repExtER.cpp -o v_repExtER.o
	g++ $(CFLAGS) -c ERFiles/ER.cpp -o ER.o
	g++ $(CFLAGS) -c ERFiles/DefaultGenome.cpp -o DefaultGenome.o
	g++ $(CFLAGS) -c ERFiles/Population.cpp -o Population.o
	g++ $(CFLAGS) -c ERFiles/control/ANN.cpp -o ANN.o
	g++ $(CFLAGS) -c ERFiles/control/Control.cpp -o Control.o
	g++ $(CFLAGS) -c ERFiles/control/ControlFactory.cpp -o ControlFactory.o
	g++ $(CFLAGS) -c ERFiles/control/Hormones.cpp -o Hormones.o
	g++ $(CFLAGS) -c ERFiles/control/SimpleControl.cpp -o SimpleControl.o
#	g++ $(CFLAGS) -c ERFiles/control/TransferNetwork.cpp -o TransferNetwork.o
	g++ $(CFLAGS) -c ERFiles/env/Environment.cpp -o Environment.o
	g++ $(CFLAGS) -c ERFiles/env/EnvironmentFactory.cpp -o EnvironmentFactory.o
	g++ $(CFLAGS) -c ERFiles/env/ConstrainedSunEnv.cpp -o ConstrainedSunEnv.o
	g++ $(CFLAGS) -c ERFiles/env/BasicSunEnv.cpp -o BasicSunEnv.o
	g++ $(CFLAGS) -c ERFiles/env/MoveAndSun.cpp -o MoveAndSun.o
	g++ $(CFLAGS) -c ERFiles/env/MoveEnv.cpp -o MoveEnv.o
	g++ $(CFLAGS) -c ERFiles/env/MovingSunEnv.cpp -o MovingSunEnv.o
	g++ $(CFLAGS) -c ERFiles/env/RoughMoveEnv.cpp -o RoughMoveEnv.o
	g++ $(CFLAGS) -c ERFiles/env/WaterEnv.cpp -o WaterEnv.o
	g++ $(CFLAGS) -c ERFiles/module/ER_Module.cpp -o ER_Module.o
	g++ $(CFLAGS) -c ERFiles/module/Module_APlantBase.cpp -o Module_APlantBase.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Bend.cpp -o Module_Bend.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Brain.cpp -o Module_Brain.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Cube.cpp -o Module_Cube.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Leaf.cpp -o Module_Leaf.o
	g++ $(CFLAGS) -c ERFiles/module/Module_LeafChloe.cpp -o Module_LeafChloe.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Rectangle.cpp -o Module_Rectangle.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Rodrigo.cpp -o Module_Rodrigo.o
	g++ $(CFLAGS) -c ERFiles/module/Module_Spring.cpp -o Module_Spring.o
	g++ $(CFLAGS) -c ERFiles/module/ModuleFactory.cpp -o ModuleFactory.o
	g++ $(CFLAGS) -c ERFiles/morphology/BaseMorphology.cpp -o BaseMorphology.o
	g++ $(CFLAGS) -c ERFiles/morphology/ER_LSystem.cpp -o ER_LSystem.o
	g++ $(CFLAGS) -c ERFiles/morphology/FixedBaseMorphology.cpp -o FixedBaseMorphology.o
	g++ $(CFLAGS) -c ERFiles/morphology/Morphology.cpp -o Morphology.o
	g++ $(CFLAGS) -c ERFiles/morphology/MorphologyFactory.cpp -o MorphologyFactory.o
	g++ $(CFLAGS) -c ERFiles/neuron/CPGNeuron.cpp -o CPGNeuron.o
	g++ $(CFLAGS) -c ERFiles/neuron/InputNeuron.cpp -o InputNeuron.o
	g++ $(CFLAGS) -c ERFiles/neuron/Neuron.cpp -o Neuron.o
	g++ $(CFLAGS) -c ERFiles/neuron/NeuronFactory.cpp -o NeuronFactory.o
	g++ $(CFLAGS) -c ERFiles/neuron/OutputNeuron.cpp -o OutputNeuron.o
	g++ $(CFLAGS) -c ERFiles/neuron/SimpleNeuron.cpp -o SimpleNeuron.o
	g++ $(CFLAGS) -c ERFiles/CollisionDetector.cpp -o CollisionDetector.o
	
	@mkdir -p lib
	g++ v_repExtER.o v_repLib.o ER.o DefaultGenome.o Population.o ANN.o Control.o ControlFactory.o Hormones.o SimpleControl.o Environment.o EnvironmentFactory.o ConstrainedSunEnv.o BasicSunEnv.o MoveAndSun.o MoveEnv.o MovingSunEnv.o RoughMoveEnv.o WaterEnv.o ER_Module.o Module_APlantBase.o Module_Bend.o Module_Brain.o Module_Cube.o Module_Leaf.o Module_LeafChloe.o Module_Rectangle.o Module_Rodrigo.o Module_Spring.o ModuleFactory.o BaseMorphology.o ER_LSystem.o FixedBaseMorphology.o Morphology.o MorphologyFactory.o CPGNeuron.o InputNeuron.o Neuron.o NeuronFactory.o OutputNeuron.o SimpleNeuron.o CollisionDetector.o -o lib/libv_repExtER.$(EXT) -lpthread -ldl -shared